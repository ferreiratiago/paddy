api-version: reviewpad.com/v3.x

groups:
  - name: size-labels
    spec: '["feat XS", "feat S", "feat M", "feat L", "feat XL"]'
  - name: ignored-patterns
    spec: '["*.lock","*.csv","*.yaml","*.txt"]'
  - name: labels
    spec: '["guides", "bug", "build", "do not merge", "docker", "docs", "duplicate", "enhancement", "feat XS", "feat S", "feat M", "feat L", "feat XL", "help wanted", "refactor", "tests", "discord", "dependencies", "notebookreports", "dashboards", "analytics", "portfolio", "installer", "SDK", "HACKTOBERFEST"]'

workflows:
  - name: label-pull-request-with-size
    description: Label pull request based on the number of lines changed
    always-run: true
    if:
        # Calculate size while ignoring patterns in the "ignored-patterns" group
        # For more details about size follow https://docs.reviewpad.com/guides/built-ins/#size
        - rule: $size($group("ignored-patterns")) <= 100
          extra-actions:
              - $removeLabels($group("size-labels"))
              - $addLabel("feat XS")
        - rule: $size($group("ignored-patterns")) > 100 && $size($group("ignored-patterns")) <= 300
          extra-actions:
              - $removeLabels($group("size-labels"))
              - $addLabel("feat S")
        - rule: $size($group("ignored-patterns")) > 300 && $size($group("ignored-patterns")) <= 900
          extra-actions:
              - $removeLabels($group("size-labels"))
              - $addLabel("feat M")
        - rule: $size($group("ignored-patterns")) > 900 && $size($group("ignored-patterns")) <= 1800
          extra-actions:
              - $removeLabels($group("size-labels"))
              - $addLabel("feat L")
        - rule: $size($group("ignored-patterns")) > 1800
          extra-actions:
              - $removeLabels($group("size-labels"))
              - $addLabel("feat XL")
  - name: validate-labels
    description: Validate pull request labels
    always-run: true
    if:
      # Validate that pull request has at least one label from the labels group
      - rule: '!$any($labels(), ($label: String => $isElementOf($label, $group("labels"))))'
        extra-actions:
          - $error("Pull request must have at least one label")
          - $fail("Pull request must have at least one label")
      # Fail reviewpad check when pull request has the label "do not merge" 
      - rule: $isElementOf("do not merge", $labels())
        extra-actions:
          - $fail("Pull request has the label \"do not merge\"")
